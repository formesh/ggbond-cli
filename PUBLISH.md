# è‡ªåŠ¨å‘å¸ƒæŒ‡å—

æœ¬é¡¹ç›®é…ç½®äº† Git Hook æ¥å®ç°æäº¤æ—¶è‡ªåŠ¨å‘å¸ƒ npm åŒ…çš„åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å‘å¸ƒï¼ˆæ¨èï¼‰

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
pnpm version:patch   # è¡¥ä¸ç‰ˆæœ¬ (1.0.0 -> 1.0.1)
pnpm version:minor   # æ¬¡è¦ç‰ˆæœ¬ (1.0.0 -> 1.1.0)
pnpm version:major   # ä¸»è¦ç‰ˆæœ¬ (1.0.0 -> 2.0.0)

# 2. æäº¤æ›´æ”¹
git add .
git commit -m "chore: bump version to x.x.x"

# 3. æ‰‹åŠ¨å‘å¸ƒ
pnpm publish:cli
```

### æ–¹å¼äºŒï¼šè‡ªåŠ¨å‘å¸ƒ

```bash
# 1. å¯ç”¨è‡ªåŠ¨å‘å¸ƒ
export AUTO_PUBLISH=true

# 2. æ›´æ–°ç‰ˆæœ¬å¹¶æäº¤ï¼ˆä¼šè‡ªåŠ¨è§¦å‘å‘å¸ƒï¼‰
pnpm version:patch
git add .
git commit -m "chore: bump version"

# æˆ–è€…ä½¿ç”¨å¿«æ·å‘½ä»¤
pnpm commit:publish -m "your commit message"
```

## ğŸ“‹ å·¥ä½œåŸç†

1. **Git Hook**: ä½¿ç”¨ `post-commit` é’©å­ç›‘å¬æäº¤
2. **æ¡ä»¶æ£€æŸ¥**: 
   - æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† `AUTO_PUBLISH=true` ç¯å¢ƒå˜é‡
   - æ£€æŸ¥æ˜¯å¦åœ¨ä¸»åˆ†æ”¯ (`main` æˆ– `master`)
   - æ£€æŸ¥ `packages/cli/package.json` æ˜¯å¦æœ‰å˜æ›´
3. **è‡ªåŠ¨æµç¨‹**: 
   - æ„å»ºé¡¹ç›® (`pnpm build`)
   - å‘å¸ƒåˆ° npm (`npm publish`)

## ğŸ› ï¸ å¯ç”¨è„šæœ¬

| è„šæœ¬ | æè¿° |
|------|------|
| `pnpm publish:cli` | æ‰‹åŠ¨æ„å»ºå¹¶å‘å¸ƒ CLI åŒ… |
| `pnpm commit:publish` | å¯ç”¨è‡ªåŠ¨å‘å¸ƒçš„æäº¤ |
| `pnpm version:patch` | å‡çº§è¡¥ä¸ç‰ˆæœ¬å· |
| `pnpm version:minor` | å‡çº§æ¬¡è¦ç‰ˆæœ¬å· |
| `pnpm version:major` | å‡çº§ä¸»è¦ç‰ˆæœ¬å· |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **npm ç™»å½•**: ç¡®ä¿å·²ç™»å½• npm (`npm login`)
2. **æƒé™æ£€æŸ¥**: ç¡®ä¿æœ‰å‘å¸ƒæƒé™
3. **ç‰ˆæœ¬ç®¡ç†**: å»ºè®®ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
4. **æµ‹è¯•**: å‘å¸ƒå‰ç¡®ä¿ä»£ç å·²é€šè¿‡æµ‹è¯•
5. **ç¯å¢ƒå˜é‡**: è‡ªåŠ¨å‘å¸ƒé»˜è®¤å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨

## ğŸ”§ é…ç½®æ–‡ä»¶

- **Git Hook**: `.husky/post-commit`
- **åŒ…é…ç½®**: `packages/cli/package.json`
- **é¡¹ç›®è„šæœ¬**: `package.json`

## ğŸš« ç¦ç”¨è‡ªåŠ¨å‘å¸ƒ

```bash
# ä¸´æ—¶ç¦ç”¨
unset AUTO_PUBLISH

# æˆ–è€…ä¸è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
git commit -m "normal commit"
```

## ğŸ› æ•…éšœæ’é™¤

å¦‚æœè‡ªåŠ¨å‘å¸ƒå¤±è´¥ï¼š

1. æ£€æŸ¥æ„å»ºæ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥ npm ç™»å½•çŠ¶æ€
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
5. ä½¿ç”¨æ‰‹åŠ¨å‘å¸ƒä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ